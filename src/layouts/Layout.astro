---
// Learn about using Astro layouts:
// https://docs.astro.build/en/core-concepts/layouts/

// Component Imports
import Nav from "../components/Nav.astro";
import Footer from "../components/Footer.astro";
import AccessibilityFeatures from "../components/AccessibilityFeatures.astro";
import FontAwesomeFallback from "../components/FontAwesomeFallback.astro";
import SEO from "../components/SEO.astro";
import "../styles/global.css";

interface Props {
  title?: string | undefined;
  description?: string | undefined;
  image?: string | undefined;
  type?: string | undefined;
  article?: {
    publishedTime?: string;
    modifiedTime?: string;
    tags?: string[];
    authors?: string[];
  };
}

const {
  title,
  description,
  image = "/assets/social-preview.jpg",
  type = "website",
  article,
} = Astro.props;
---

<!doctype html>
<html lang="fr" class="scroll-smooth">
  <head>
    <!-- Utilisation du composant SEO pour toutes les balises meta -->
    <SEO
      title={title}
      description={description}
      image={image}
      type={type}
      article={article}
    />

    <!-- Autres balises head spécifiques à cette page -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body
    class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen font-[Inter]"
  >
    <AccessibilityFeatures />
    <FontAwesomeFallback />

    <div class="stack backgrounds">
      <Nav />

      <main id="main-content">
        <slot />
      </main>

      <Footer />
    </div>

    <script>
      // Add "loaded" class once the document has completely loaded.
      addEventListener("load", () =>
        document.documentElement.classList.add("loaded")
      );

      // Check if the user prefers dark mode (if not already handled by MainHead)
      if (
        localStorage.theme === "dark" ||
        (!("theme" in localStorage) &&
          window.matchMedia("(prefers-color-scheme: dark)").matches)
      ) {
        document.documentElement.classList.add("dark", "theme-dark");
      } else {
        document.documentElement.classList.remove("dark", "theme-dark");
      }

      // Enhanced micro-interactions script
      document.addEventListener("DOMContentLoaded", () => {
        // Smooth transition between sections
        const setupSectionTransitions = () => {
          const sections = document.querySelectorAll("section");
          const options = {
            root: null,
            rootMargin: "0px",
            threshold: 0.1,
          };

          const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                entry.target.classList.add("section-visible");
              }
            });
          }, options);

          sections.forEach((section) => {
            section.classList.add("section-transition");
            observer.observe(section);
          });
        };

        // Button hover effects
        const setupButtonEffects = () => {
          const buttons = document.querySelectorAll(
            "button, .link, a.btn, .button"
          );

          buttons.forEach((button) => {
            button.addEventListener("mouseenter", () => {
              button.classList.add("button-hover");
            });

            button.addEventListener("mouseleave", () => {
              button.classList.remove("button-hover");
            });

            button.addEventListener("click", () => {
              button.classList.add("button-active");
              setTimeout(() => {
                button.classList.remove("button-active");
              }, 300);
            });
          });
        };

        setupSectionTransitions();
        setupButtonEffects();
      });
    </script>

    <style>
      :root {
        --_placeholder-bg: linear-gradient(transparent, transparent);
        --bg-image-main: url("/assets/backgrounds/bg-main-light-800w.jpg");
        --bg-image-main-curves: url("/assets/backgrounds/bg-main-light.svg");
        --bg-image-subtle-1: var(--_placeholder-bg);
        --bg-image-subtle-2: var(--_placeholder-bg);
        --bg-image-footer: var(--_placeholder-bg);
        --bg-svg-blend-mode: overlay;
        --bg-blend-mode: darken;
        --bg-image-aspect-ratio: 2.25;
        --bg-scale: 1.68;
        --bg-aspect-ratio: calc(var(--bg-image-aspect-ratio) / var(--bg-scale));
        --bg-gradient-size: calc(var(--bg-scale) * 100%);
      }

      :root.theme-dark {
        --bg-image-main: url("/assets/backgrounds/bg-main-dark-800w.jpg");
        --bg-image-main-curves: url("/assets/backgrounds/bg-main-dark.svg");
        --bg-svg-blend-mode: darken;
        --bg-blend-mode: lighten;
      }

      /* These backgrounds are displayed below the fold, so we lazy load them
         once the `.loaded` class has been set.  */
      :root.loaded {
        --bg-image-subtle-1: url("/assets/backgrounds/bg-subtle-1-light-800w.jpg");
        --bg-image-subtle-2: url("/assets/backgrounds/bg-subtle-2-light-800w.jpg");
        --bg-image-footer: url("/assets/backgrounds/bg-footer-light-800w.jpg");
      }
      :root.loaded.theme-dark {
        --bg-image-subtle-1: url("/assets/backgrounds/bg-subtle-1-dark-800w.jpg");
        --bg-image-subtle-2: url("/assets/backgrounds/bg-subtle-2-dark-800w.jpg");
        --bg-image-footer: url("/assets/backgrounds/bg-footer-dark-800w.jpg");
      }

      @media (min-width: 48em) {
        :root {
          --bg-scale: 1;
          --bg-image-main: url("/assets/backgrounds/bg-main-light-1440w.jpg");
        }
        :root.theme-dark {
          --bg-image-main: url("/assets/backgrounds/bg-main-dark-1440w.jpg");
        }

        :root.loaded {
          --bg-image-subtle-1: url("/assets/backgrounds/bg-subtle-1-light-1440w.jpg");
          --bg-image-subtle-2: url("/assets/backgrounds/bg-subtle-2-light-1440w.jpg");
          --bg-image-footer: url("/assets/backgrounds/bg-footer-light-1440w.jpg");
        }
        :root.loaded.theme-dark {
          --bg-image-subtle-1: url("/assets/backgrounds/bg-subtle-1-dark-1440w.jpg");
          --bg-image-subtle-2: url("/assets/backgrounds/bg-subtle-2-dark-1440w.jpg");
          --bg-image-footer: url("/assets/backgrounds/bg-footer-dark-1440w.jpg");
        }
      }

      .backgrounds {
        min-height: 100%;
        isolation: isolate;
        background:
          /*noise*/
          url("/assets/backgrounds/noise.png") top center/220px repeat,
          /*footer*/ var(--bg-image-footer) bottom
            center/var(--bg-gradient-size) no-repeat,
          /*header1*/ var(--bg-image-main-curves) top
            center/var(--bg-gradient-size) no-repeat,
          /*header2*/ var(--bg-image-main) top center/var(--bg-gradient-size)
            no-repeat,
          /*base*/ var(--gray-999);
        background-blend-mode: /*noise*/
          overlay,
          /*footer*/ var(--bg-blend-mode),
          /*header1*/ var(--bg-svg-blend-mode),
          /*header2*/ normal,
          /*base*/ normal;
      }
      @media (forced-colors: active) {
        /* Deactivate custom backgrounds for high contrast users. */
        .backgrounds {
          background: none;
          background-blend-mode: none;
          --bg-gradient-size: none;
        }
      }

      /* Micro-interactions styles */
      .section-transition {
        opacity: 0;
        transform: translateY(20px);
        transition:
          opacity 0.6s ease,
          transform 0.6s ease;
      }

      .section-visible {
        opacity: 1;
        transform: translateY(0);
      }

      .button-hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .button-active {
        transform: scale(0.95);
      }

      /* Respect user's reduced motion preferences */
      @media (prefers-reduced-motion: reduce) {
        .section-transition,
        .section-visible,
        .button-hover,
        .button-active {
          transition: none;
          transform: none;
          animation: none;
        }
      }
    </style>
  </body>
</html>
