import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as s,R as k}from"./index.Dj3USz-F.js";import{s as j}from"./supabase.DnZPE_vy.js";import{S as p,A as c,a as d,b as u,B as g,I as N}from"./spinner.B1hKNfa3.js";import"./_commonjsHelpers.gnU0ypJ3.js";function z(){const[i,m]=s.useState(""),[l,n]=s.useState(!1),[a,o]=s.useState(!1),[x,r]=s.useState(null),[w,v]=s.useState(null),y=async h=>{h.preventDefault();let f=!0;if(i?/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/.test(i)||(v("Format d'email invalide"),f=!1):(v("L'email est requis"),f=!1),!!f){n(!0),r(null);try{const{error:t}=await j.auth.resend({type:"signup",email:i,options:{emailRedirectTo:`${window.location.origin}/docs/verify-email`}});if(t)throw t;o(!0)}catch(t){r("Une erreur s'est produite lors de l'envoi de l'email. Veuillez réessayer."),console.error("Email verification request error:",t)}finally{n(!1)}}};return a?e.jsxs(c,{variant:"success",className:"mb-4",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-check-circle",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),e.jsx(d,{children:"Email envoyé !"}),e.jsxs(u,{children:["Un nouvel email de vérification a été envoyé à ",i,". Veuillez vérifier votre boîte de réception et suivre les instructions pour activer votre compte."]})]}):e.jsxs("div",{className:"space-y-4",children:[x&&e.jsxs(c,{variant:"destructive",className:"mb-4",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-alert-circle",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),e.jsx(d,{children:"Erreur"}),e.jsx(u,{children:x})]}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium mb-1",children:"Email"}),e.jsx(N,{id:"email",type:"email",value:i,onChange:h=>m(h.target.value),placeholder:"votre@email.com",error:w||void 0,icon:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-mail",children:[e.jsx("rect",{width:"20",height:"16",x:"2",y:"4",rx:"2"}),e.jsx("path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"})]})})]}),e.jsx(g,{type:"submit",disabled:l,className:"w-full",children:l?e.jsxs(e.Fragment,{children:[e.jsx(p,{size:"sm",className:"mr-2"}),"Envoi en cours..."]}):"Renvoyer l'email de vérification"})]}),e.jsx("div",{className:"text-center mt-4",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Retourner à la"," ",e.jsx("a",{href:"/docs/login",className:"text-indigo-600 hover:text-indigo-800 font-medium",children:"page de connexion"})]})})]})}function R(){const[i,m]=s.useState(!0),[l,n]=s.useState(!1),[a,o]=s.useState(null);return k.useEffect(()=>{(async()=>{try{const{data:{session:r}}=await j.auth.getSession();r?n(!0):o("La vérification de l'email a échoué ou le lien a expiré. Veuillez demander un nouvel email de vérification.")}catch(r){o("Une erreur s'est produite lors de la vérification de l'email. Veuillez réessayer."),console.error("Email verification status error:",r)}finally{m(!1)}})()},[]),i?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(p,{size:"lg",className:"mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Vérification de l'email en cours..."})]}):a?e.jsxs(c,{variant:"destructive",className:"mb-4",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-alert-circle",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),e.jsx(d,{children:"Erreur"}),e.jsxs(u,{children:[a,e.jsx("div",{className:"mt-4",children:e.jsx("a",{href:"/docs/verify-email-request",className:"text-white underline",children:"Demander un nouvel email de vérification"})})]})]}):l?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(c,{variant:"success",className:"mb-4",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-check-circle",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),e.jsx(d,{children:"Email vérifié !"}),e.jsx(u,{children:"Votre email a été vérifié avec succès. Vous pouvez maintenant vous connecter à votre compte."})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(g,{onClick:()=>window.location.href="/docs/login",className:"px-6",children:"Se connecter"})})]}):null}export{R as EmailVerificationStatus,z as RequestEmailVerification};
