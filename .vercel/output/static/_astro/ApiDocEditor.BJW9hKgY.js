import{j as s}from"./jsx-runtime.D_zvdyIk.js";import{r as d}from"./index.Dj3USz-F.js";import{s as c}from"./supabase.B2_sgsx_.js";import"./_commonjsHelpers.gnU0ypJ3.js";function T({projectId:n,endpointId:m}){const[l,h]=d.useState([]),[f,u]=d.useState(!0),[t,i]=d.useState(null),[x,g]=d.useState(!1);d.useEffect(()=>{b(),m?y(m):p()},[n,m]);const b=async()=>{u(!0);try{const{data:e,error:r}=await c.from("api_endpoints").select("*").eq("project_id",n);if(r)throw r;h(e||[])}catch(e){console.error("Error fetching API endpoints:",e)}finally{u(!1)}},y=async e=>{try{const{data:r,error:a}=await c.from("api_endpoints").select("*").eq("id",e).single();if(a)throw a;i(r)}catch(r){console.error("Error fetching endpoint:",r),p()}},j=e=>{i(e)},p=()=>{i({project_id:n,path:"",method:"GET",summary:"",description:"",request_body:{},responses:{200:{description:"Successful operation",content:{"application/json":{schema:{}}}}}})},o=(e,r)=>{i({...t,[e]:r})},v=async()=>{if(t){g(!0);try{let e;if(t.id){const{data:r,error:a}=await c.from("api_endpoints").update({path:t.path,method:t.method,summary:t.summary,description:t.description,request_body:t.request_body,responses:t.responses,updated_at:new Date().toISOString()}).eq("id",t.id).select().single();if(a)throw a;e=r}else{const{data:r,error:a}=await c.from("api_endpoints").insert([{project_id:n,path:t.path,method:t.method,summary:t.summary,description:t.description,request_body:t.request_body,responses:t.responses}]).select().single();if(a)throw a;e=r}t.id?h(l.map(r=>r.id===e.id?e:r)):h([...l,e]),i(e),window.location.href=`/docs/projects/${n}/api/${e.id}`}catch(e){console.error("Error saving endpoint:",e),alert(`Error saving endpoint: ${e.message}`)}finally{g(!1)}}};return s.jsxs("div",{className:"api-doc-editor grid grid-cols-4 gap-4",children:[s.jsxs("div",{className:"col-span-1 border-r pr-4",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Endpoints"}),s.jsx("button",{onClick:p,className:"mb-4 py-2 px-4 bg-green-600 text-white rounded-md hover:bg-green-700",children:"Add New Endpoint"}),f?s.jsx("p",{children:"Loading endpoints..."}):s.jsx("ul",{className:"space-y-2",children:l.length===0?s.jsx("p",{children:"No endpoints defined yet."}):l.map(e=>s.jsxs("li",{className:`p-2 rounded cursor-pointer ${t?.id===e.id?"bg-indigo-100":"hover:bg-gray-100"}`,onClick:()=>j(e),children:[s.jsx("span",{className:`inline-block px-2 py-1 text-xs font-bold rounded mr-2 ${e.method==="GET"?"bg-blue-500 text-white":e.method==="POST"?"bg-green-500 text-white":e.method==="PUT"?"bg-yellow-500 text-white":e.method==="DELETE"?"bg-red-500 text-white":"bg-gray-500 text-white"}`,children:e.method}),s.jsx("span",{children:e.path})]},e.id))})]}),s.jsx("div",{className:"col-span-3",children:t?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h3",{className:"text-xl font-semibold",children:t.id?"Edit Endpoint":"New Endpoint"}),s.jsx("button",{onClick:v,disabled:x,className:"py-2 px-4 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:x?"Saving...":"Save Endpoint"})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"HTTP Method"}),s.jsxs("select",{value:t.method,onChange:e=>o("method",e.target.value),className:"w-full rounded-md border-gray-300 shadow-sm",children:[s.jsx("option",{value:"GET",children:"GET"}),s.jsx("option",{value:"POST",children:"POST"}),s.jsx("option",{value:"PUT",children:"PUT"}),s.jsx("option",{value:"DELETE",children:"DELETE"}),s.jsx("option",{value:"PATCH",children:"PATCH"}),s.jsx("option",{value:"OPTIONS",children:"OPTIONS"})]})]}),s.jsxs("div",{className:"col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Path"}),s.jsx("input",{type:"text",value:t.path,onChange:e=>o("path",e.target.value),placeholder:"/api/resource/{id}",className:"w-full rounded-md border-gray-300 shadow-sm"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Summary"}),s.jsx("input",{type:"text",value:t.summary,onChange:e=>o("summary",e.target.value),placeholder:"Brief summary of what this endpoint does",className:"w-full rounded-md border-gray-300 shadow-sm"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description"}),s.jsx("textarea",{value:t.description,onChange:e=>o("description",e.target.value),placeholder:"Detailed description of the endpoint",className:"w-full rounded-md border-gray-300 shadow-sm",rows:3})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Request Body (JSON)"}),s.jsx("textarea",{value:JSON.stringify(t.request_body,null,2),onChange:e=>{try{const r=JSON.parse(e.target.value);o("request_body",r)}catch{console.log("Invalid JSON, will not update until valid")}},placeholder:"{ ... }",className:"w-full rounded-md border-gray-300 shadow-sm font-mono text-sm",rows:6})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Responses (JSON)"}),s.jsx("textarea",{value:JSON.stringify(t.responses,null,2),onChange:e=>{try{const r=JSON.parse(e.target.value);o("responses",r)}catch{console.log("Invalid JSON, will not update until valid")}},placeholder:"{ ... }",className:"w-full rounded-md border-gray-300 shadow-sm font-mono text-sm",rows:6})]})]}):s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsx("p",{className:"text-gray-500",children:"Select an endpoint from the list or create a new one to get started."})})})]})}export{T as default};
