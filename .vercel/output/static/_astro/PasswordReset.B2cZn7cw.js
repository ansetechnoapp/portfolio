import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r}from"./index.Dj3USz-F.js";import{s as E}from"./supabase.DnZPE_vy.js";import{c as n,A as y,a as k,b as N,I as L,B as P,S as C}from"./spinner.B1hKNfa3.js";import"./_commonjsHelpers.gnU0ypJ3.js";function M({password:s,className:i}){const t=B(s);return e.jsxs("div",{className:n("mt-2",i),children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-xs",children:"Force du mot de passe"}),e.jsxs("span",{className:"text-xs font-medium",children:[t===0&&"Très faible",t===1&&"Faible",t===2&&"Moyen",t===3&&"Fort",t===4&&"Très fort"]})]}),e.jsx("div",{className:"w-full h-1.5 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:n("h-full transition-all duration-300",t===0&&"w-1/5 bg-red-500",t===1&&"w-2/5 bg-orange-500",t===2&&"w-3/5 bg-yellow-500",t===3&&"w-4/5 bg-lime-500",t===4&&"w-full bg-green-500")})}),s&&e.jsxs("ul",{className:"mt-2 grid grid-cols-2 gap-x-4 gap-y-1 text-xs",children:[e.jsxs("li",{className:n("flex items-center gap-1",s.length>=8?"text-green-500":"text-gray-500"),children:[e.jsx(v,{className:s.length>=8?"text-green-500":"text-gray-300"}),"Minimum 8 caractères"]}),e.jsxs("li",{className:n("flex items-center gap-1",/[A-Z]/.test(s)?"text-green-500":"text-gray-500"),children:[e.jsx(v,{className:/[A-Z]/.test(s)?"text-green-500":"text-gray-300"}),"Une majuscule"]}),e.jsxs("li",{className:n("flex items-center gap-1",/[0-9]/.test(s)?"text-green-500":"text-gray-500"),children:[e.jsx(v,{className:/[0-9]/.test(s)?"text-green-500":"text-gray-300"}),"Un chiffre"]}),e.jsxs("li",{className:n("flex items-center gap-1",/[^A-Za-z0-9]/.test(s)?"text-green-500":"text-gray-500"),children:[e.jsx(v,{className:/[^A-Za-z0-9]/.test(s)?"text-green-500":"text-gray-300"}),"Un caractère spécial"]})]})]})}function B(s){if(!s)return 0;let i=0;return s.length>=8&&(i+=1),/[A-Z]/.test(s)&&(i+=1),/[0-9]/.test(s)&&(i+=1),/[^A-Za-z0-9]/.test(s)&&(i+=1),i}function v({className:s}){return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}const S=s=>/^(?=.*[A-Z])(?=.*[0-9])(?=.*[^A-Za-z0-9]).{8,}$/.test(s);function U(){const[s,i]=r.useState(""),[t,m]=r.useState(!1),[h,g]=r.useState(!1),[j,c]=r.useState(null),[f,o]=r.useState(null);r.useEffect(()=>{o(null),c(null)},[s]);const b=async a=>{a.preventDefault();let d=!0;if(s?/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/.test(s)||(o("Format d'email invalide"),d=!1):(o("L'email est requis"),d=!1),!!d){m(!0),c(null);try{const{error:l}=await E.auth.resetPasswordForEmail(s,{redirectTo:`${window.location.origin}/docs/reset-password`});if(l)throw l;g(!0)}catch(l){c("Une erreur s'est produite lors de l'envoi de l'email. Veuillez réessayer."),console.error("Password reset request error:",l)}finally{m(!1)}}};return h?e.jsxs(y,{variant:"success",className:"mb-4",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-check-circle",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),e.jsx(k,{children:"Email envoyé !"}),e.jsxs(N,{children:["Un email de réinitialisation de mot de passe a été envoyé à ",s,". Veuillez vérifier votre boîte de réception et suivre les instructions pour réinitialiser votre mot de passe."]})]}):e.jsxs("div",{className:"space-y-4",children:[j&&e.jsxs(y,{variant:"destructive",className:"mb-4",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-alert-circle",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),e.jsx(k,{children:"Erreur"}),e.jsx(N,{children:j})]}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium mb-1",children:"Email"}),e.jsx(L,{id:"email",type:"email",value:s,onChange:a=>i(a.target.value),placeholder:"votre@email.com",error:f||void 0,icon:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-mail",children:[e.jsx("rect",{width:"20",height:"16",x:"2",y:"4",rx:"2"}),e.jsx("path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"})]})})]}),e.jsx(P,{type:"submit",disabled:t,className:"w-full",children:t?e.jsxs(e.Fragment,{children:[e.jsx(C,{size:"sm",className:"mr-2"}),"Envoi en cours..."]}):"Réinitialiser le mot de passe"})]}),e.jsx("div",{className:"text-center mt-4",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Vous vous souvenez de votre mot de passe ?"," ",e.jsx("a",{href:"/docs/login",className:"text-indigo-600 hover:text-indigo-800 font-medium",children:"Se connecter"})]})})]})}function q(){const[s,i]=r.useState(""),[t,m]=r.useState(""),[h,g]=r.useState(!1),[j,c]=r.useState(!1),[f,o]=r.useState(null),[b,a]=r.useState(null),[d,l]=r.useState(null),[p,A]=r.useState(!1);r.useEffect(()=>{s&&!S(s)?a("Le mot de passe doit contenir au moins 8 caractères, une majuscule, un chiffre et un caractère spécial"):a(null)},[s]),r.useEffect(()=>{l(s&&t&&s!==t?"Les mots de passe ne correspondent pas":null)},[s,t]);const z=async u=>{u.preventDefault();let x=!0;if(s?S(s)||(a("Le mot de passe doit contenir au moins 8 caractères, une majuscule, un chiffre et un caractère spécial"),x=!1):(a("Le mot de passe est requis"),x=!1),t?s!==t&&(l("Les mots de passe ne correspondent pas"),x=!1):(l("La confirmation du mot de passe est requise"),x=!1),!!x){g(!0),o(null);try{const{error:w}=await E.auth.updateUser({password:s});if(w)throw w;c(!0),setTimeout(()=>{window.location.href="/docs/login"},3e3)}catch(w){o("Une erreur s'est produite lors de la mise à jour du mot de passe. Veuillez réessayer."),console.error("Password update error:",w)}finally{g(!1)}}};return j?e.jsxs(y,{variant:"success",className:"mb-4",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-check-circle",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),e.jsx(k,{children:"Mot de passe mis à jour !"}),e.jsx(N,{children:"Votre mot de passe a été mis à jour avec succès. Vous allez être redirigé vers la page de connexion..."})]}):e.jsxs("div",{className:"space-y-4",children:[f&&e.jsxs(y,{variant:"destructive",className:"mb-4",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-alert-circle",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),e.jsx(k,{children:"Erreur"}),e.jsx(N,{children:f})]}),e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium mb-1",children:"Nouveau mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{id:"password",type:p?"text":"password",value:s,onChange:u=>i(u.target.value),error:b||void 0,icon:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-lock",children:[e.jsx("rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})}),e.jsx("button",{type:"button",className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",onClick:()=>A(!p),children:p?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-eye-off",children:[e.jsx("path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24"}),e.jsx("path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"}),e.jsx("path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"}),e.jsx("line",{x1:"2",x2:"22",y1:"2",y2:"22"})]}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-eye",children:[e.jsx("path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),e.jsx(M,{password:s,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium mb-1",children:"Confirmer le mot de passe"}),e.jsx(L,{id:"confirmPassword",type:p?"text":"password",value:t,onChange:u=>m(u.target.value),error:d||void 0,icon:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-shield-check",children:[e.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"}),e.jsx("path",{d:"m9 12 2 2 4-4"})]})})]}),e.jsx(P,{type:"submit",disabled:h,className:"w-full",children:h?e.jsxs(e.Fragment,{children:[e.jsx(C,{size:"sm",className:"mr-2"}),"Mise à jour en cours..."]}):"Mettre à jour le mot de passe"})]})]})}export{U as RequestPasswordReset,q as UpdatePassword};
